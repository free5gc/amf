## 優先UE制御実装のウォークスルー

### 実施された変更点

#### 1. 設定 (`pkg/factory/config.go`)

`PriorityUE` 設定セクションを追加し、以下を定義可能にしました：

* **IMSIPattern**: 優先UEを特定するための正規表現パターン（例：特定の末尾番号など）。
* **MaxConcurrency**: 非優先UEの同時処理制限数。

#### 2. 登録ハンドラ (`internal/gmm/handler.go`)

`HandleRegistrationRequest` を修正し、以下の処理を追加しました：

* SUPI/SUCIの解析とログ記録。
* 設定された `IMSIPattern` との照合。
* **優先UE**: 直ちに処理を開始。
* **非優先UE**: セマフォ（バッファ付きチャネル）を使用してバッファリング/スロットリングを実施。これにより、同時に処理される非優先の登録リクエスト数が効果的に制限されます。

---

### 検証手順

#### 1. 設定の更新

`config/amfcfg.yaml`（または使用中の設定ファイル）を編集し、priorityセクションを追加します。

```yaml
configuration:
  # ... 既存の設定 ...
  priorityUE:
    imsiPattern: "^imsi-[0-9]*[0-4]$" # 例: 末尾が0-4のIDを優先とする
    maxConcurrency: 10 # 非優先UEの同時処理を10件に制限

```

#### 2. AMFの起動

更新した設定ファイルを使用してAMFを起動します。

#### 3. UERANSIMの実行

大量のUE接続テストを実行します。
`./nr-ue -c config.yaml -n 100`
※前提条件：UERANSIMによって生成されるIMSIが、テストしたいパターンの分布と一致していること。

#### 4. ログの確認

AMFのログ（`amf.log` またはコンソール出力）を確認します。

* **優先UE**: `[GMM] Info: Priority UE detected: ...` と表示され、即座に処理されていること。
* **非優先UE**: `[GMM] Info: Non-priority UE buffered: ...` と表示され、スロットが空くにつれて低速またはバッチ単位で処理されていること。

---

### 検証チェックリスト

* [ ] 設定がエラーなく正常に読み込まれているか。
* [ ] 優先UEが正しく識別されているか。
* [ ] 非優先UEがバッファリングされているか（ログで確認）。
* [ ] 高負荷条件下でシステムが安定しているか。
